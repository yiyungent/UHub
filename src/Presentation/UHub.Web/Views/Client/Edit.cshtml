@using UHub.Web.Models.Client
@model ClientViewModel

@{

	string[] allGrantTypes = (string[])ViewData["AllGrantTypes"];
}

<div class="card">
	<div class="card-body">
		<div class="btn-group">
			<a type="button" class="btn btn-secondary" asp-controller="Client" asp-action="Index">返回</a>
			<button id="js-btn-save" onclick="saveData()" class="btn btn-primary">保存</button>
		</div>
		@if (Model != null)
		{
			<form id="js-form">
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">Id</label>
					<div class="col-sm-9">
						<input name="Id" type="text" class="form-control" readonly value="@Model.Id">
					</div>
				</div>
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">ClientId</label>
					<div class="col-sm-9">
						<input name="ClientId" type="text" class="form-control" value="@Model.ClientId">
					</div>
				</div>
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">ClientSecret</label>
					<div class="col-sm-9">
						<input name="ClientSecret" type="text" class="form-control" placeholder="不修改秘钥留空">
					</div>
				</div>S
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">显示名</label>
					<div class="col-sm-9">
						<input name="DisplayName" type="text" class="form-control" value="@Model.DisplayName">
					</div>
				</div>
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">描述</label>
					<div class="col-sm-9">
						<input name="Description" type="text" class="form-control" value="@Model.Description">
					</div>
				</div>
				<div class="form-group">
					<label>授权类型</label>
					<select name="AllowedGrantTypes" class="form-control">
						@foreach (var item in allGrantTypes)
						{
							// TODO: 目前不支持多选
							bool isSelected = Model.AllowedGrantTypes.FirstOrDefault() == item;
							if (isSelected)
							{
								<option value="@item" selected>@item</option>
							}
							else
							{
								<option value="@item">@item</option>
							}
						}
					</select>
				</div>
				<div class="form-group">
					<label>允许范围</label>
					<textarea name="AllowedScopes" class="form-control" rows="5" placeholder="多个之间用,隔开">@string.Join(",", Model.AllowedScopes)</textarea>
				</div>
				<div class="form-group">
					<label>跨域白名单</label>
					<textarea name="AllowedCorsOrigins" class="form-control" rows="5" placeholder="多个之间用,隔开">@string.Join(",", Model.AllowedCorsOrigins)</textarea>
				</div>
				<div class="form-group">
					<label>登出后跳转地址</label>
					<textarea name="PostLogoutRedirectUris" class="form-control" rows="5" placeholder="多个之间用,隔开">@string.Join(",", Model.PostLogoutRedirectUris)</textarea>
				</div>
				<div class="form-group">
					<label>登录后跳转地址</label>
					<textarea name="RedirectUris" class="form-control" rows="5" placeholder="多个之间用,隔开">@string.Join(",", Model.RedirectUris)</textarea>
				</div>
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">需要同意授权</label>
					<select name="RequireConsent" class="form-control">
						@if (Model.RequireConsent)
						{
							<option value="True" selected>是</option>
							<option value="False">否</option>
						}
						else
						{
							<option value="True">是</option>
							<option value="False" selected>否</option>
						}
					</select>
				</div>
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">允许AccessToken经由浏览器传输</label>
					<select name="AllowAccessTokensViaBrowser" class="form-control">
						@if (Model.AllowAccessTokensViaBrowser)
						{
							<option value="True" selected>是</option>
							<option value="False">否</option>
						}
						else
						{
							<option value="True">是</option>
							<option value="False" selected>否</option>
						}
					</select>
				</div>
				<div class="form-group row">
					<label class="col-sm-3 col-form-label">总是包含UserClaims在IdToken中</label>
					<select name="AlwaysIncludeUserClaimsInIdToken" class="form-control">
						@if (Model.AlwaysIncludeUserClaimsInIdToken)
						{
							<option value="True" selected>是</option>
							<option value="False">否</option>
						}
						else
						{
							<option value="True">是</option>
							<option value="False" selected>否</option>
						}
					</select>
				</div>
			</form>
		}
		else
		{
			<div class="alert alert-danger" role="alert">找不到此客户端</div>
		}
	</div>
</div>
@section scripts
{
	<script>
		function saveDataSuccess(data) {
			if (data.code <= 0) {
				showMessage(data.message, -1);
			} else {
				showMessage(data.message, 1);
			}
			$("#js-btn-save").html("保存").removeAttr("disabled");
		}

		function saveData() {
			$("#js-btn-save").html("保存中").attr("disabled", "disabled");
			$.ajax({
				url: "/Client/Edit",
				type: "post",
				dataType: "json",
				data: $("#js-form").serialize(),
				success: saveDataSuccess
			});
			return false;
		}
	</script>
}
